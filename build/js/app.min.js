var app=app||{};!function($){$.postJson=function(t,e){return $.ajax(t,{global:!1,type:"POST",cache:!1,contentType:"application/json"})}}(jQuery),function(t,$,e){var n="http://rawgit.com/NAPWebProductionEditTeam/MagTool2/master/",o="?v="+e.commit,i="build/css/app.css",a="build/tpl/magtool.html",r=function(t){var r;$.when($.get(n+i+o).done(function(){$("<link>").attr({rel:"stylesheet",href:n+i+o}).appendTo($("head"))}),$.get(n+a+o).done(function(t){r=t})).then(function(){e.$body.append(r),t()})};e.Loader={load:r}}(window,$,app),function(t,$,e,n){var o,i=function(){return"undefined"==typeof o&&(o=$("#page"+n.get_CurrentPageNumber())),o},a=function(){return i().data("id")},r=function(){return i().data("feature-title")};e.Page={get:i,getId:a,getTitle:r}}(window,jQuery,app,magazineBuilder),function(t,$,e){var n=$("#html"),o=function(){n.html("")},i=function(){e.Page.get().find("[style]:not(.videoLoader):not(object)").removeAttr("style"),e.Page.get().find("[contenteditable], [aria-disabled], [data-mtifont], .ui-resizable, .onEdit").removeClass("onEdit ui-resizable").removeAttr("contenteditable aria-disabled data-mtifont")},a=function(){return o(),e.Page.get().find('[class^="credits"]').clone().appendTo(n),n.contents()},r=function(){return o(),e.Page.get().find('.magazineContent div:not([class^="credits"]):not(.edLetterList):not(.videoHolder)').clone().appendTo(n),n.contents()},d=function(){return o(),e.Page.get().find(".videoHolder #videojs").clone().appendTo(n),n.contents()};e.ContentEditor={cleanUp:i,getCreditsHtml:a,getContentHtml:r,getVideoHtml:d}}(window,jQuery,app),function(t,$,e){var n="http://webprod-nap.dave.net-a-porter.com/save_test",o=function(t,e,o){var i={req_type:"save_changes",page_id:t,credit:e,content:o};return $.postJson(n,JSON.stringify(i))};e.Server={save:o}}(window,jQuery,app),function(t,$,e){e.$body=$("body"),e.Loader.load(function(){}),e.save=function(){e.ContentEditor.cleanUp();var t=e.Page.getId(),n=e.ContentEditor.getCreditsHtml(),o=e.ContentEditor.getContentHtml(),i=e.ContentEditor.getVideoHtml();console.info("Copy the following output into common/script.html:"),console.log(">>>> BEGIN SCRIPT.HTML CONTENT <<<<"),console.log(i),console.log("<<<< END SCRIPT.HTML CONTENT >>>>"),e.Server.save(t,n,o).done(function(){console.log("Saved successfully")}).fail(function(){console.log("Save error")})}}(window,$,app);